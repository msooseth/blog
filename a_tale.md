# A Tale of Shift Right, Frontrunning, and MEV

This blog post is about trying to see the traditionally undesired so-called "frontrunning", observed on cryptocurrency chains, as a form of attack detection & response. Frontrunning is big business, and I believe there is reason to believe it will provide a form of on-chain security, and there seem to be signs this is already happening.

The NIST [Cybersecurity Framework's five Functions](https://www.nist.gov/cyberframework/online-learning/five-functions) are: Identify, Protect, Detect, Respond, and Recover. Within this framework "shift left" means that we shift our focus towards Identify and Protect, i.e. towards fixing issues before our system is deployed into production. Say, if you have a bug in your Apple Store/Google Play app, you'd prefer fixing it before you deploy it to the internet, or, similarily you prefer fixing the bug in your cryptocurrency contract before you deploy it in the wild (i.e. "on the mainnet"). While "shift left" makes lots of sense (let's prevent the issue in the first place!), in many cases, preventing all issues is likely impossible.

## Shifting Left

Firstly, it is important to state that preventing all issues is often impossible because of what [safety practicioners call](https://www.amazon.com/Field-Guide-Understanding-Human-Error/dp/1472439058) the "blunt end". When writing code, practicioners, i.e. developers, are at, what safety literature would call, the "sharp end": they are like airplane pilots, directly at the control of their craft. While it's easy to imagine that pilots are in "full control", in reality, airplane pilots depend on and are affected by many things: accurate weather reports, quality and amount of training, certification bodies, proper aircraft maintenance, production pressure from corporate, etc. These are what safety literature calls the "blunt end" -- things that contribute to both success and failure, but are not directly visible/obvious. When the 10th plane drops out of the air this same year, and Boeing keeps blaming the (now dead) pilots, you know it's the blunt end you ought to be looking at.

What this boils down to in terms of shift left is that while developers are in "full control", in reality, there is a large blunt end that they have little to no control over, and which may set up the conditions such that failure is inevitable, even with the most careful of developers. An easy example of this is previously unknown vulnerability classes: for example unknown issues with [CPU cache timing side-channels](https://www.intel.com/content/www/us/en/architecture-and-technology/side-channel-variants-1-2-3.html) in classical IT security, or [flash loan attacks](https://halborn.com/what-is-a-flash-loan-attack/) for cryptocurrency contracts, where an attacker can instantly obtain a large capital for a fraction of time to break assumptions about a contract, thereby e.g. helping to drain it of funds. Another slightly less obvious example is production pressure, where competing entities are known to be working on the same idea/system and releasing first is critical for business success. It is one thing to "ask for time", it's another thing when you gotta release or it was all for nothing. While techniques like [fuzzing](https://lcamtuf.coredump.cx/afl/), [formal verification](https://github.com/leonardoalt/ethereum_formal_verification_overview), best practices, etc. can help, they are neither bulletproof, nor are they resonable to expect to be done fully for all contracts.

## Shifting Right

The IT security sector has realized for some time now that spending all their time on shift left, i.e. identifing issues and preventing them pre-deployment, is not adequate. With some effort, time, and money being spent on detection, adequate response, and recovery, i.e. post-deployment and hence on the "right" side, the impact of attacks or unforseen events can be minimized. This is incredibly important, because as per above, it is often impossible to prevent all attacks. From phishing attacks, novel attack classes, persistent attackers, to production pressures, some attacks will go through, and be successful -- at which point the only question is how successful will they be, i.e. will they reach all (or any) of their intended goals, or will they be stopped early, minimizing the damage caused.

There are some interesting properties of spending proper time dealing with post-production incidents. Firstly, it allows the system designers and developers to understand what attack patterns are typical against systems. In classical IT security, e.g. [honeypots](https://www.kaspersky.com/resource-center/threats/what-is-a-honeypot) are often used to understand attacker behaviour. These are (often under-protected) systems deployed either on the public internet, or more interestingly, on the intranet(s) of organizations, to see if (and how) attackers try to attack it. These systems can help spot (novel) attack patterns, and attackers in general. Other information-sharing systems are also in-place in the traditional IT security world: in Germany [the BSI](https://www.bsi.bund.de/EN/Home/home_node.html) is responsible to warn large enterprises of (novel/successful) attack patterns in the wild. Within the space of cryptocurrencies, attacks tend to be on the public chain, and can be observed directly both as they happen, and retrospectively, thanks to the public ledger. There is plenty to learn from how others succceed, or fail.

## MEV, Frontrunning, and Shift Right

With all the above out of the way, let's get to the meat of this article: how behaviour patterns in the cryptocurrency world that are often cited as undesirable are actually doing a form of shift right. This inadvertent shift right is something I believe we could exploit to improve the safety of the chain overall.

So-called "frontrunning" is a technique that consists of people listening to the set of sent, but unconfirmed transactions on the chain, and seeing if copying the same transaction themselves would make them money. They then submit the same transaction with a higher fee, giving more fee to the miners who confirm transactions. This leads to both transactions being executed, but theirs being executed first (and the 2nd likely failing), thereby giving them the money. Clearly, miners (who confirm transactions) could always do frontrunning, and could do it much easier, since they decide who is going to be first, so they can make themselves first without paying a higher (or any) fee. The generalization of frontrunning, which includes more complicated multi-step transactions (e.g. [sandwitching](https://github.com/j2abro/UniswapV2-Sandwich-Attack-Detector)) is called Miner Extractable Value (MEV). MEV is big business, with [8 million USD extracted in the past 30 days](https://explore.flashbots.net/) on the Ethereum chain, as of writing.

When you frontrun, you do two things: (1) you constantly check for potential value to be extracted, such an attack would do, and (2) you front-run the transaction that extracts the value to get the value for yourself. This clearly maps to the post-deployment part of the Cybersecurity Framework of NIST: detect & respond. In other words, it would actually make sense to constantly run a flashbot (as frontrunning systems are called) on-chain to detect and front run attacks against your own contracts(!). In a sense, the [frontrunners](https://pdaian.com/flashboys2.pdf) are operating what in the traditional IT security world would be called a SOC -- a Security Operations Center that is constantly on the lookout for attacks.

In this sense, MEV is not undesired, but a price to pay to have a non-stop security system. Of course, it is not a given that flashbot operators exctracting MEV will give back your money for the attack they front-ran. However, I posit that it's much more likely that you'll get your money back from them than the attackers. For example, at the [MEV day for Devconnect](https://mevday.org/836f88806995412dabc1c7bb7ce4e830), there was a discussion I participated in where a large flashbot operator mentioned that they were willing to give back the funds of attacks they front-ran for a 10% fee. I expect that large organizations will in the future run their own flash bots, and medium-sized ones will either simply pay the fee (10% or whatever it will be) when an attack happens, or perhaps pay a montly fee for the flashbot service provided.

## Conclusions

While Miner Extractable Value (MEV) seems on the surface to be an undesirable side-effect of the combination of current cryptocurrency protocols and the public nature of digital ledgers, it can also be seen as a feature. This feature allows one to perform detection & reponse to attacks, allowing legitimate entities to mitigate the impact of attacks post-deployment. There is some evidence that some people running MEV bots are already effectively providing flashbots as a form of post-deployment attack-mitigation-as-a-service.
